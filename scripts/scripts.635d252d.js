"use strict";angular.module("unbeschriebenEpApp",["ngAria","mediaPlayer","ngRoute","sticky"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",reloadOnSearch:!1}).otherwise({redirectTo:"/"}),b.html5Mode(!0)}]).run(["$rootScope",function(a){a.getBackground=function(){return{"background-image":'url("http://res.cloudinary.com/xiphe/image/upload/w_'+100*Math.ceil(window.innerWidth/100)+",h_"+100*Math.ceil(window.innerHeight/100)+',c_fill,q_80/bg_xrqytx.jpg")'}},a.getFooterBg=function(){var a=document.getElementById("footer");return a?{"background-image":'url("http://res.cloudinary.com/xiphe/image/upload/w_'+100*Math.ceil(a.offsetWidth/100)+",h_"+100*Math.ceil(a.offsetHeight/100)+',c_fill,q_80/true_n7lfap.jpg")'}:!1}}]),angular.module("unbeschriebenEpApp").controller("MainCtrl",["$scope","ep","$compile","$timeout","$route","$routeParams",function(a,b,c,d,e,f){a.ep=b,a.download=!1,a.pw={text:""},f.download&&(a.download=!0),a.$watch("download",function(a){e.updateParams({download:a?"show":void 0})}),a.applySticky=function(){var b=angular.element(document.getElementById("become-sticky"));b.attr({sticky:!0,"sticky-class":"sticky"}).html("<ng-include src=\"'views/cta.html'\"></ng-include>"),c(b)(a)},angular.element(document).on("click",function(a){[a.target,a.target.parentNode].forEach(function(a){if(a.tagName){var b=a.tagName.toLowerCase();-1!==["a","button"].indexOf(b)&&d(function(){a.blur()},150)}})}),a.playIfPause=function(){a.epPlayer.playing||a.epPlayer.play()},a.getCoverWidth=function(){var a=document.getElementsByClassName("cover_img")[0];return 50*Math.ceil(a.offsetWidth/50)},a.validPw=function(){return"ein bisschen weiter"===a.pw.text}}]),angular.module("unbeschriebenEpApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("unbeschriebenEpApp").factory("ep",function(){return[{name:"Zeig mir die Welt",view:"views/tracks/zmdw.html",src:"https://dl.dropboxusercontent.com/s/j9jmcrpkbu81r8n/kaleidos_welt_master2.mp3?dl=0",type:"audio/mpeg"},{name:"Absinth",view:"views/tracks/absinth.html",src:"https://dl.dropboxusercontent.com/s/ts51xd0yikelf21/kaleidos_absinth_master2.mp3?dl=0",type:"audio/mpeg"},{name:"Bruder",view:"views/tracks/bruder.html",src:"https://dl.dropboxusercontent.com/s/o65nuj5qe7xoi9p/kaleidos_bruder_master2.mp3?dl=0",type:"audio/mpeg"},{name:"Alles Brennt",view:"views/tracks/allesbrennt.html",src:"https://dl.dropboxusercontent.com/s/oelbai3arov7wqe/kaleidos_alles_brennt_master2.mp3?dl=0",type:"audio/mpeg"},{name:"Das Versprechen",view:"views/tracks/versprechen.html",src:"https://dl.dropboxusercontent.com/s/0m285m9x9bd0ror/kaleidos_versprechen_master2.mp3?dl=0",type:"audio/mpeg"}]}),angular.module("unbeschriebenEpApp").directive("track",["ep","$route","$routeParams",function(a,b,c){return{templateUrl:"views/tracks/main.html",scope:{track:"=data",player:"="},restrict:"E",link:function(d,e){d.i=a.indexOf(d.track),d.isOpen=!1,d.track.slug=d.slug=d.track.name.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,""),d.playing=!1,d.player.on("play",function(){return d.isCurrent()?void(d.playing=!0):void(d.playing=!1)}),d.player.on("pause",function(){d.playing=!1}),d.seek=function(a){var b=a.x||a.screenX,c=e[0].querySelector(".track").getClientRects()[0],f=(b-c.left)/(c.right-c.left);d.player.seek(d.player.duration*f)},d.loaded=function(){return(d.player.loadPercent||0)+"%"},d.played=function(){return 100*(d.player.currentTime/d.player.duration||0)+"%"},d.isCurrent=function(){return d.player.currentTrack===d.i+1},d.$watch("playing",function(a){a?b.updateParams({play:d.slug}):!a&&d.isCurrent()&&d.player.loadPercent>0&&b.updateParams({play:void 0})}),d.open=function(){d.isOpen=!0},d.playPause=function(){d.isCurrent()?d.player.playPause():d.player.play(d.i)},d.getState=function(){return d.playing?d.STATE_PLAYING:d.isOpen?d.STATE_OPEN:d.STATE_CLOSED},d.STATE_CLOSED=0,d.STATE_OPEN=1,d.STATE_PLAYING=2,d.$watch(function(){return c.play},function(a){a===d.slug&&(d.open(),d.playing||d.playPause())})}}}]),function(){function a(){}angular.module("unbeschriebenEpApp").service("player",a)}(),angular.module("unbeschriebenEpApp").directive("trackImage",function(){return{restrict:"C",require:"^trackview",link:function(a,b,c,d){function e(){k=d.element[0].getBoundingClientRect(),l=b[0].getBoundingClientRect()}function f(){e(),m=window.innerHeight-r}function g(){return l.width===k.width?!1:m>=l.height?!1:k.height<=l.height?!1:!0}function h(){return o>0&&1>o?!0:k.top>r?!1:k.bottom<=m?!1:!0}function i(){requestAnimationFrame(function(){e(),h()&&(n=k.height-m,o=(k.top-r)/(n+r)*-1,0>o?o=0:o>1&&(o=1),p=k.height-l.height,b.css("top",p*o+"px"))})}function j(){f(),g()?q.on("scroll",i):(q.off("scroll",i),b.css("top","0px"))}var k,l,m,n,o,p,q=angular.element(window),r=31;a.getWidth=function(){return 50*Math.ceil(b[0].offsetWidth/50)},angular.element(b).on("load",function(){q.on("resize",j),j()})}}}),angular.module("unbeschriebenEpApp").directive("trackview",function(){return{restrict:"C",controller:["$element",function(a){this.element=a}]}}),angular.module("unbeschriebenEpApp").directive("imageOnload",function(){return{restrict:"A",link:function(a,b,c){b.bind("load",function(){a.$eval(c.imageOnload)})}}}),angular.module("unbeschriebenEpApp").directive("emailbutton",["$http",function(a){return{templateUrl:"views/emailbutton.html",restrict:"E",link:function(b){b.email={address:""},b.state={done:!1},b.$watch("email.address",function(a,c){a!==c&&(b.state.done=""===a)}),b.go=function(){a.post("http://unbeschrieben-download.diem-musik.de/subscribe",{email:b.email.address}).then(function(){b.email.address=""})}}}}]);