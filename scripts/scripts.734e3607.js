"use strict";angular.module("unbeschriebenEpApp",["ngAria","ngAudio","ngRoute","sticky"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",reloadOnSearch:!1}).when("/impressum",{templateUrl:"views/impressum.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"}),b.html5Mode(!0)}]).run(["$rootScope",function(a){var b=window.devicePixelRatio||1;a.getBackground=function(){var a=100*Math.ceil(window.innerWidth/100),c=100*Math.ceil(window.innerHeight/100);return{"background-size":a+"px "+c+"px","background-image":'url("http://res.cloudinary.com/xiphe/image/upload/w_'+a*b+",h_"+c*b+',c_fill,q_80/bg_xrqytx.jpg")'}},a.getFooterBg=function(){var a=document.getElementById("footer");if(!a)return!1;var c=100*Math.ceil(a.offsetWidth/100),d=100*Math.ceil(a.offsetHeight/100);return{"background-size":c+"px "+d+"px","background-image":'url("http://res.cloudinary.com/xiphe/image/upload/w_'+c*b+",h_"+d*b+',c_fill,q_80/true_n7lfap.jpg")'}}}]),angular.module("unbeschriebenEpApp").controller("MainCtrl",["$scope","ep","$compile","$timeout","$route","$routeParams",function(a,b,c,d,e,f){a.ep=b,a.download=!1,a.pw={text:""},f.download&&(a.download=!0),a.$watch("download",function(a){e.updateParams({download:a?"show":void 0})}),a.applySticky=function(){var b=angular.element(document.getElementById("become-sticky"));b.attr({sticky:!0,"sticky-class":"sticky"}).html("<ng-include src=\"'views/cta.html'\"></ng-include>"),c(b)(a)},angular.element(document).on("click",function(a){[a.target,a.target.parentNode].forEach(function(a){if(a.tagName){var b=a.tagName.toLowerCase();["a","button"].indexOf(b)!==-1&&d(function(){a.blur()},150)}})}),a.playIfPause=b.play,a.getCoverWidth=function(){var a=document.getElementsByClassName("cover_img")[0];return 50*Math.ceil(a.offsetWidth/50)*window.devicePixelRatio||1}}]),angular.module("unbeschriebenEpApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("unbeschriebenEpApp").factory("ep",["ngAudio","ngAudioGlobals",function(a,b){function c(b){var c=d.playlist[b];c.audio=a.load(c.src),c.loading=!0;var e=-1,f=-1,g=setInterval(function(){if(c.audio.audio&&angular.isFunction(c.audio.play)){var a=c.audio.audio;a.onended=function(){d.next(),d.play()};var b=setInterval(function(){try{c.loaded=a.buffered.end(0)/a.duration*100}catch(a){}c.loading=c.loaded!==f||f!==e,e=f,f=c.loaded,c.loaded>=100&&(c.loading=!1,clearInterval(b))},1e3);clearInterval(g)}},5)}b.unlock=!0;var d={};return d.current={n:-1},d.playlist=[{name:"Zeig mir die Welt",view:"views/tracks/zmdw.html",src:"https://s3.eu-central-1.amazonaws.com/unbeschrieben/zeig_mir_die_welt.mp3",type:"audio/mpeg"},{name:"Absinth",view:"views/tracks/absinth.html",src:"https://s3.eu-central-1.amazonaws.com/unbeschrieben/absinth.mp3",type:"audio/mpeg"},{name:"Bruder",view:"views/tracks/bruder.html",src:"https://s3.eu-central-1.amazonaws.com/unbeschrieben/bruder.mp3",type:"audio/mpeg"},{name:"Alles Brennt",view:"views/tracks/allesbrennt.html",src:"https://s3.eu-central-1.amazonaws.com/unbeschrieben/alles_brennt.mp3",type:"audio/mpeg"},{name:"Das Versprechen",view:"views/tracks/versprechen.html",src:"https://s3.eu-central-1.amazonaws.com/unbeschrieben/das_versprechen.mp3",type:"audio/mpeg"}],d.skip=function(a){if(!a||a>=d.playlist.length?a=0:a<0&&(a=d.playlist.length-1),d.current.n!==a){var b=d.paused();if(d.current.n>=0&&!b){var e=d.playlist[d.current.n],f=10*Math.round(10*(e.audio.currentTime/e.audio.duration||0));f<90&&window._gaq.push(["_trackEvent",d.playlist[d.current.n].name,"skipped at "+f+"%"])}d.stop(),d.current.n=a,d.playlist[a].audio||c(a),b||d.play()}return d.current.n},d.next=function(){d.skip(d.current.n+1)},d.prev=function(){d.skip(d.current.n-1)},d.play=function(){d.paused()&&(window._gaq.push(["_trackEvent",d.playlist[d.current.n].name,"play"]),d.playlist[d.current.n].audio.play())},d.pause=function(){d.playlist[d.current.n].audio.pause()},d.paused=function(){return!!(d.current.n<0||!d.playlist[d.current.n].audio||angular.isUndefined(d.playlist[d.current.n].audio.paused))||d.playlist[d.current.n].audio.paused},d.stop=function(){d.current.n>=0&&d.playlist[d.current.n].audio&&d.playlist[d.current.n].audio.stop()},d.playPause=function(){d.paused()?d.play():d.pause()},d.skip(),d}]),angular.module("unbeschriebenEpApp").directive("track",["ep","$route","$routeParams",function(a,b,c){return{templateUrl:"views/tracks/main.html",scope:{track:"=data",player:"="},restrict:"E",link:function(d,e){d.i=a.playlist.indexOf(d.track),d.isOpen=!1,d.track.slug=d.slug=d.track.name.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,""),d.seek=function(a){var b=a.x||a.screenX,c=e[0].querySelector(".track").getClientRects()[0],f=(b-c.left)/(c.right-c.left);d.track.audio.audio.currentTime=d.track.audio.duration*f},d.loaded=function(){return(d.track.loaded||0)+"%"},d.played=function(){return 100*(d.track.audio.currentTime/d.track.audio.duration||0)+"%"},d.playing=function(){return d.i===a.current.n&&!a.paused()},d.$watch(d.playing,function(c){a.current.n===d.i&&(c?b.updateParams({play:d.slug}):c||b.updateParams({play:void 0}))}),d.open=function(){d.isOpen=!0},d.playPause=function(){a.current.n===d.i?a.playPause():d.play()},d.play=function(){a.skip(d.i),a.play()};var f=d.$watch(function(){return c.play},function(a){a===d.slug&&(d.open(),d.playing()||d.play(),f())})}}}]),angular.module("unbeschriebenEpApp").directive("trackImage",function(){return{restrict:"C",require:"^trackview",link:function(a,b,c,d){function e(){k=d.element[0].getBoundingClientRect(),l=b[0].getBoundingClientRect()}function f(){e(),m=window.innerHeight-r}function g(){return l.width!==k.width&&(!(m>=l.height)&&!(k.height<=l.height))}function h(){return o>0&&o<1||!(k.top>r)&&!(k.bottom<=m)}function i(){requestAnimationFrame(function(){e(),h()&&(n=k.height-m,o=(k.top-r)/(n+r)*-1,o<0?o=0:o>1&&(o=1),p=k.height-l.height,b.css("top",p*o+"px"))})}function j(){f(),g()?q.on("scroll",i):(q.off("scroll",i),b.css("top","0px"))}var k,l,m,n,o,p,q=angular.element(window),r=31;a.getWidth=function(){return 50*Math.ceil(b[0].offsetWidth/50)*window.devicePixelRatio||1},angular.element(b).on("load",function(){q.on("resize",j),j()})}}}),angular.module("unbeschriebenEpApp").directive("trackview",function(){return{restrict:"C",controller:["$element",function(a){this.element=a}]}}),angular.module("unbeschriebenEpApp").directive("imageOnload",["$rootScope",function(a){return{restrict:"A",link:function(b,c,d){c.bind("load",function(){b.$eval(d.imageOnload),a.$digest()})}}}]),angular.module("unbeschriebenEpApp").directive("emailbutton",["$http",function(a){return{templateUrl:"views/emailbutton.html",restrict:"E",link:function(b){b.email={address:""},b.state={done:!1},b.$watch("email.address",function(a,c){a!==c&&(b.state.done=""===a)}),b.go=function(){a.post("http://unbeschrieben-download.hannesdiem.de/subscribe",{email:b.email.address}).then(function(){b.email.address=""})}}}}]);